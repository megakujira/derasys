<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>でらしふ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>〇月シフト出勤希望休提出</h1>
        <h2>氏名：〇〇〇〇</h2>

    
        <div id="timeContainer">
        <!-- 初期の時間帯1 -->
            <div class="time-block">
                <button class="remove-btn hidden">削除</button>
                <div class="block-title">時間帯 1</div>
                <!-- 休暇タイプの選択 -->
                <div class="leave-type">
                    <label><input type="radio" name="leave-type1" value="公休" checked>公休</label>
                    <label><input type="radio" name="leave-type1"value="有給">有給</label>
                </div>
                <hr>
                <!-- 時間帯選択 -->
                <div class="radio-group">
                    <label><input type="radio" name="type1" value="split" checked> 区分け</label>
                    <label><input type="radio" name="type1" value="custom"> カスタム</label>
                </div>
                <div class="select-box">
                    <label>時間区分けタイプ</label>
                    <select id="timeselect">
                        <option class="default" value="">タイプを選択してください</option>
                        <option value="A">A : 07:00~16:00</option>
                        <option value="B">B : 08:00~17:00</option>
                        <option value="C">C : 09:00~18:00</option>
                        <option value="D">D : 10:30~19:30</option>
                    </select>
                </div>
                <div class="input-box hidden">
                    <input id="startTime" type="time" placeholder="開始時間">
                    <input id="endTime" type="time" placeholder="終了時間">
                </div>
            </div>
        </div>

        <button class="add-btn" id="addBtn">+</button>

        
        <div class="calendar">
            <h2 id="month-title"></h2>
            <table id="calendar-body"></table>
        </div>
        
        <div class="remarks">
        <div class="remarks-title">備考欄</div>
        <textarea placeholder="内容を入力してください"></textarea>
        </div>  

        <input type="submit" class="submit-btn"value="送信" onclick="sendBtn()">
    
    </div>



  <script>
        const container = document.getElementById('timeContainer');
        const addBtn = document.getElementById('addBtn');

        function setupRadioEvents(block) {
            const radios = block.querySelectorAll('input[type="radio"]');
            const selectBox = block.querySelector('.select-box');
            const inputBox = block.querySelector('.input-box');

            radios.forEach(radio => {
            radio.addEventListener('change', () => {
                if (radio.value === 'custom') {
                selectBox.classList.add('hidden');
                inputBox.classList.remove('hidden');
                } else {
                selectBox.classList.remove('hidden');
                inputBox.classList.add('hidden');
                }
            });
            });
        }

        function setupRemoveButton(block) {
            const removeBtn = block.querySelector('.remove-btn');
            removeBtn.addEventListener('click', () => {
            block.remove();
            });
        }

        setupRadioEvents(container.querySelector('.time-block'));

        addBtn.addEventListener('click', () => {
            const count = container.querySelectorAll('.time-block').length + 1;
            const newBlock = document.createElement('div');
            newBlock.className = 'time-block';
            newBlock.innerHTML = `
            <button class="remove-btn">削除</button>
            <div class="block-title">時間帯 ${count}</div>
            <div class="leave-type">
                    <label><input type="radio" name="leave-type${count}" value="公休" checked>公休</label>
                    <label><input type="radio" name="leave-type${count}"value="有給">有給</label>
            </div>
            <hr>
            <div class="radio-group">
                <label><input type="radio" name="type${count}" value="split" checked> 区分け</label>
                <label><input type="radio" name="type${count}" value="custom"> カスタム</label>
            </div>
            <div class="select-box">
                <label>時間区分けタイプ</label>
                <select>
                        <option class="default" value="">タイプを選択してください</option>
                        <option value="A">A : 07:00~16:00</option>
                        <option value="B">B : 08:00~17:00</option>
                        <option value="C">C : 09:00~18:00</option>
                        <option value="D">D : 10:30~19:30</option>
                </select>
            </div>
            <div class="input-box hidden">
                <input id="startTime" type="time" placeholder="開始時間">
                <input id="endTime" type="time" placeholder="終了時間">
            </div>
            `;
            container.appendChild(newBlock);
            setupRadioEvents(newBlock);
            setupRemoveButton(newBlock);
        });

        const calendarBody = document.getElementById("calendar-body");
        const monthTitle = document.getElementById("month-title");

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1; // 0=1月
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        const daysOfWeek = ["日","月","火","水","木","金","土"];
        monthTitle.textContent = `${month + 1}月`;

        // 曜日ヘッダー
        let headerRow = "<tr>" + daysOfWeek.map(d => `<th>${d}</th>`).join("") + "</tr>";
        let html = headerRow + "<tr>";

        // 空白セル
        for (let i = 0; i < firstDay.getDay(); i++) html += "<td></td>";

        // 日付セル
        for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        const isToday = day === today.getDate();
        const dateKey = `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        html += `<td data-date="${dateKey}" class="${isToday ? "selected" : ""}">${day}</td>`;
        if (date.getDay() === 6 && day !== lastDay.getDate()) html += "</tr><tr>";
        }

        html += "</tr>";
        calendarBody.innerHTML = html;

        // 登録データ管理
        const selectedData = {}; //{"2025-11-01":"B"}
        let selectedDateCell = null;

        selectedDateCell = document.querySelector("#calendar-body td.selected");

        // 一番最初にrestoreを呼んで状態同期
        if (selectedDateCell) {
          restoreDayData(selectedDateCell.dataset.date);
        }

        const timeSelect1 = document.getElementById("timeselect");
        const startInput1 = document.getElementById("startTime");
        const endInput1 = document.getElementById("endTime");

        // 情報登録
        
calendarBody.addEventListener("click", e => {
  if (e.target.tagName !== "TD" || !e.target.dataset.date) return;

  // --- 旧日付を保存 ---
  if (selectedDateCell) saveDayData(selectedDateCell.dataset.date);

  // --- 選択状態を変更 ---
  document.querySelectorAll("#calendar-body td").forEach(td => td.classList.remove("selected"));
  e.target.classList.add("selected");
  selectedDateCell = e.target;

  // ---  新しい日付のデータを復元 ---
  restoreDayData(selectedDateCell.dataset.date);
});

// --- 日付の情報を保存 ---
function saveDayData(dateKey) {
  const blocks = container.querySelectorAll('.time-block');
  const dayData = [];

  blocks.forEach((block, i) => {
    const mode = block.querySelector(`input[name="type${i+1}"]:checked`).value;
    const select = block.querySelector("select");
    const inputs = block.querySelectorAll('input[type="time"]');
    const leaveType = block.querySelector(`input[name="leave-type${i+1}"]:checked`).value;


    let entry = { mode, leaveType };
    let isValid = false; // 有効データ判定フラグ

    if (mode === "split") {
      const val = select.value;
      if (val && val !== "") {
        entry.value = val;
        isValid = true;
      }
    } else {
      const start = inputs[0].value;
      const end = inputs[1].value;
      if (start && end) {
        entry.start = start;
        entry.end = end;
        isValid = true;
      }
    }

    
    // 有効な場合のみ登録
    if (isValid) {
      dayData.push(entry);
    }
  });

  // 保存
  selectedData[dateKey] = dayData;

  // === 背景色更新 ===
  const cell = document.querySelector(`[data-date="${dateKey}"]`);
  if (!cell) return;

  if (dayData.length >= 2) {
    cell.style.background = "linear-gradient(to right, pink 50%, lightgreen 50%)";
  } else if (dayData.length === 1) {
    cell.style.background = "pink";
  } else {
    cell.style.background = "";
  }

  console.log(dateKey, dayData);
}

// --- 日付の情報を復元 ---
function restoreDayData(dateKey) {
  const data = selectedData[dateKey] || [];

  // 一旦全削除
  container.innerHTML = "";

  // データ分だけ生成
  data.forEach((item, i) => {
    const newBlock = document.createElement("div");
    newBlock.className = "time-block";
    newBlock.innerHTML = `
      <button class="remove-btn ${i === 0 ? "hidden" : ""}">削除</button>
      <div class="block-title">時間帯 ${i+1}</div>
      <div class="leave-type">
        <label><input type="radio" name="leave-type${i + 1}" value="公休" ${item.leaveType === "公休" ? "checked" : ""}>公休</label>
        <label><input type="radio" name="leave-type${i + 1}"value="有給" ${item.leaveType === "有給" ? "checked" : ""}>有給</label>
      </div>
      <hr>
      <div class="radio-group">
        <label><input type="radio" name="type${i+1}" value="split" ${item.mode === "split" ? "checked" : ""}> 区分け</label>
        <label><input type="radio" name="type${i+1}" value="custom" ${item.mode === "custom" ? "checked" : ""}> カスタム</label>
      </div>
      <div class="select-box ${item.mode === "custom" ? "hidden" : ""}">
        <label>時間区分けタイプ</label>
        <select>
          <option class="default" value="">タイプを選択してください</option>
          <option value="A" ${item.value==="A"?"selected":""}>A : 07:00~16:00</option>
          <option value="B" ${item.value==="B"?"selected":""}>B : 08:00~17:00</option>
          <option value="C" ${item.value==="C"?"selected":""}>C : 09:00~18:00</option>
          <option value="D" ${item.value==="D"?"selected":""}>D : 10:30~19:30</option>
        </select>
      </div>
      <div class="input-box ${item.mode === "split" ? "hidden" : ""}">
        <input type="time" value="${item.start || ""}">
        <input type="time" value="${item.end || ""}">
      </div>`;
    container.appendChild(newBlock);
    setupRadioEvents(newBlock);
    setupRemoveButton(newBlock);
  });

  // データがないときは時間帯1を作る
  if (data.length === 0) {
    addBtn.click();
    container.querySelector(".remove-btn").classList.add("hidden");
  }
}
        function sendBtn() {
            alert("送信しました。")
        }
        
  </script>
</body>
</html>
