<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã§ã‚‰ã—ãµ</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f7f7f7;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 600px;
        margin: 40px auto;
        background: #fff;
        padding: 20px 40px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1,
      h2 {
        text-align: center;
        color: #333;
      }

      form {
        margin-top: 20px;
      }

      fieldset {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 16px 20px;
        margin-bottom: 20px;
      }

      legend {
        padding: 0 8px;
        font-weight: bold;
      }

      select,
      textarea,
      input[type="text"],
      input[type="radio"] {
        margin: 8px 0;
      }

      textarea {
        width: 100%;
        height: 80px;
        border-radius: 6px;
        border: 1px solid #ccc;
        padding: 8px;
        resize: vertical;
      }

      .header {
        text-align: center;
        margin-bottom: 15px;
        font-size: 16px;
      }
      .time-block {
        border: 2px solid #333;
        padding: 12px;
        margin-bottom: 12px;
        background: #fff;
        position: relative;
      }
      .time-block::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 10px;
        height: 100%;
      }
      .time-block:nth-of-type(1)::before {
        background: pink;
      }
      .time-block:nth-of-type(2)::before {
        background: lightgreen;
      }
      .block-title {
        font-weight: bold;
        margin-bottom: 8px;
      }
      .leave-type {
        margin-bottom: 10px;
        display: flex;
        gap: 30px;
      }
      .radio-group {
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
      }
      .select-box,
      .input-box {
        margin-bottom: 10px;
      }
      select,
      input[type="text"],
      textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      .input-box {
        display: flex;
        gap: 10px;
      }
      .input-box input {
        flex: 1;
        text-align: center;
      }
      .add-btn {
        display: block;
        width: 40px;
        height: 40px;
        margin: 15px auto;
        font-size: 24px;
        text-align: center;
        line-height: 40px;
        border: 1px solid #333;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
      }
      .hidden {
        display: none;
      }
      .remove-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #f66;
        color: #fff;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 12px;
      }

      /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“ */
      .calendar {
        margin-top: 20px;
        text-align: center;
        border: 2px solid black;
      }

      #month-title {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      #calendar-body {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }

      #calendar-body th,
      #calendar-body td {
        width: 14.2%;
        height: 60px;
        text-align: center;
        vertical-align: middle;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
      }

      /* æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ */
      #calendar-body th {
        background: #f0f0f0;
        color: #555;
      }

      /* é€šå¸¸ã‚»ãƒ« */
      #calendar-body td {
        background: #fff;
      }

      /* é¸æŠçŠ¶æ…‹ */
      #calendar-body td.selected {
        background: #8fb4e1;
        color: white;
        font-weight: bold;
      }
      td.filled {
        background-color: pink !important;
      }
      .remarks {
        margin-top: 20px;
        border: 2px solid black;
        padding: 12px;
      }
      option.default {
        font-weight: bold;
      }
      /* é€ä¿¡ãƒœã‚¿ãƒ³ */
      .submit-btn {
        margin: 20px auto 0;
        display: block;
        width: 100%;
        max-width: 60px;
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        background: #e6e6e6;
        color: black;
        cursor: pointer;
        transition: background 0.2s;
      }
      .submit-btn:hover {
        background: #999999;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ã€‡æœˆã‚·ãƒ•ãƒˆå‡ºå‹¤å¸Œæœ›ä¼‘æå‡º</h1>
      <h2>æ°åï¼šã€‡ã€‡ã€‡ã€‡</h2>

      <div id="timeContainer">
        <!-- åˆæœŸã®æ™‚é–“å¸¯1 -->
        <div class="time-block">
          <button class="remove-btn hidden">å‰Šé™¤</button>
          <div class="block-title">æ™‚é–“å¸¯ 1</div>
          <!-- ä¼‘æš‡ã‚¿ã‚¤ãƒ—ã®é¸æŠ -->
          <div class="leave-type">
            <label
              ><input
                type="radio"
                name="leave-type1"
                value="å…¬ä¼‘"
                checked
              />å…¬ä¼‘</label
            >
            <label
              ><input type="radio" name="leave-type1" value="æœ‰çµ¦" />æœ‰çµ¦</label
            >
          </div>
          <hr />
          <!-- æ™‚é–“å¸¯é¸æŠ -->
          <div class="radio-group">
            <label
              ><input type="radio" name="type1" value="split" checked />
              åŒºåˆ†ã‘</label
            >
            <label
              ><input type="radio" name="type1" value="custom" />
              ã‚«ã‚¹ã‚¿ãƒ </label
            >
          </div>
          <div class="select-box">
            <label>æ™‚é–“åŒºåˆ†ã‘ã‚¿ã‚¤ãƒ—</label>
            <select id="timeselect">
              <option class="default" value="">ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="A">A : 07:00~16:00</option>
              <option value="B">B : 08:00~17:00</option>
              <option value="C">C : 09:00~18:00</option>
              <option value="D">D : 10:30~19:30</option>
            </select>
          </div>
          <div class="input-box hidden">
            <input id="startTime" type="time" placeholder="é–‹å§‹æ™‚é–“" />
            <input id="endTime" type="time" placeholder="çµ‚äº†æ™‚é–“" />
          </div>
        </div>
      </div>

      <button class="add-btn" id="addBtn">+</button>

      <div class="calendar">
        <div class="calendar-header">
          <button id="prevMonth">â†</button>
          <h2 id="month-title"></h2>
          <button id="nextMonth">â†’</button>
        </div>
        <table id="calendar-body"></table>
      </div>

      <div class="remarks">
        <div class="remarks-title">å‚™è€ƒæ¬„</div>
        <textarea placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
      </div>

      <input
        type="submit"
        class="submit-btn"
        value="é€ä¿¡"
        onclick="sendBtn()"
      />
    </div>

    <script>
      const container = document.getElementById("timeContainer");
      const addBtn = document.getElementById("addBtn");

      function setupRadioEvents(block) {
        const radios = block.querySelectorAll('input[type="radio"]');
        const selectBox = block.querySelector(".select-box");
        const inputBox = block.querySelector(".input-box");

        radios.forEach((radio) => {
          radio.addEventListener("change", () => {
            if (radio.value === "custom") {
              selectBox.classList.add("hidden");
              inputBox.classList.remove("hidden");
            } else {
              selectBox.classList.remove("hidden");
              inputBox.classList.add("hidden");
            }
          });
        });
      }

      function setupRemoveButton(block) {
        const removeBtn = block.querySelector(".remove-btn");
        removeBtn.addEventListener("click", () => {
          block.remove();
        });
      }

      setupRadioEvents(container.querySelector(".time-block"));

      addBtn.addEventListener("click", () => {
        const count = container.querySelectorAll(".time-block").length + 1;
        const newBlock = document.createElement("div");
        newBlock.className = "time-block";
        newBlock.innerHTML = `
            <button class="remove-btn">å‰Šé™¤</button>
            <div class="block-title">æ™‚é–“å¸¯ ${count}</div>
            <div class="leave-type">
                    <label><input type="radio" name="leave-type${count}" value="å…¬ä¼‘" checked>å…¬ä¼‘</label>
                    <label><input type="radio" name="leave-type${count}"value="æœ‰çµ¦">æœ‰çµ¦</label>
            </div>
            <hr>
            <div class="radio-group">
                <label><input type="radio" name="type${count}" value="split" checked> åŒºåˆ†ã‘</label>
                <label><input type="radio" name="type${count}" value="custom"> ã‚«ã‚¹ã‚¿ãƒ </label>
            </div>
            <div class="select-box">
                <label>æ™‚é–“åŒºåˆ†ã‘ã‚¿ã‚¤ãƒ—</label>
                <select>
                        <option class="default" value="">ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="A">A : 07:00~16:00</option>
                        <option value="B">B : 08:00~17:00</option>
                        <option value="C">C : 09:00~18:00</option>
                        <option value="D">D : 10:30~19:30</option>
                </select>
            </div>
            <div class="input-box hidden">
                <input id="startTime" type="time" placeholder="é–‹å§‹æ™‚é–“">
                <input id="endTime" type="time" placeholder="çµ‚äº†æ™‚é–“">
            </div>
            `;
        container.appendChild(newBlock);
        setupRadioEvents(newBlock);
        setupRemoveButton(newBlock);
      });

      let today = new Date();
      let currentYear = today.getFullYear();
      let currentMonth = today.getMonth(); // 0ã€œ11
      let selectedDateCell = null;
      let selectedData = {}; // æ—¥ä»˜ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨

      function renderCalendar(year, month) {
        const calendar = document.getElementById("calendar-body");
        const monthLabel = document.getElementById("month-title");
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        monthLabel.textContent = `${year}å¹´ ${month + 1}æœˆ`;

        let html =
          "<tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr><tr>";

        for (let i = 0; i < firstDay.getDay(); i++) {
          html += "<td></td>";
        }

        for (let day = 1; day <= lastDay.getDate(); day++) {
          const date = new Date(year, month, day);
          const dateStr = `${year}-${month + 1}-${day}`;

          // ãã®æ—¥ã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
          const isFilled =
            selectedData[dateStr] && selectedData[dateStr].length > 0;

          // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥ã¯ã€Œfilledã€ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹ï¼ˆãƒ”ãƒ³ã‚¯è¡¨ç¤ºç”¨ï¼‰
          html += `<td class="${
            isFilled ? "filled" : ""
          }" data-date="${dateStr}">${day}</td>`;
          if (date.getDay() === 6 && day !== lastDay.getDate())
            html += "</tr><tr>";
        }

        html += "</tr>";
        calendar.innerHTML = html;

        // ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        document.querySelectorAll("#calendar td[data-date]").forEach((td) => {
          td.addEventListener("click", () => {
            if (selectedDateCell) selectedDateCell.classList.remove("selected");
            td.classList.add("selected");
            selectedDateCell = td;
            const clickedDate = td.dataset.date;
            selectedData[clickedDate] = true;
            console.log("é¸æŠã•ã‚ŒãŸæ—¥ä»˜:", clickedDate);
          });
        });
      }

      // ==== ãƒœã‚¿ãƒ³ã®æŒ™å‹• ====
      document.getElementById("prevMonth").addEventListener("click", () => {
        // ä»Šæœˆã‚ˆã‚Šå‰ã«ã¯æˆ»ã‚Œãªã„ã‚ˆã†ã«åˆ¶é™
        if (
          currentYear < today.getFullYear() ||
          (currentYear === today.getFullYear() &&
            currentMonth <= today.getMonth())
        ) {
          alert("ã“ã‚Œä»¥ä¸Šå‰ã®æœˆã¯è¡¨ç¤ºã§ãã¾ã›ã‚“");
          return;
        }

        if (currentMonth === 0) {
          currentYear--;
          currentMonth = 11;
        } else {
          currentMonth--;
        }

        renderCalendar(currentYear, currentMonth);
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        // æœ€å¤§2ã‹æœˆå…ˆã¾ã§ï¼ˆä»Šæ—¥ã®æœˆ +2ï¼‰
        const maxMonth = today.getMonth() + 2;
        const maxYear = today.getFullYear() + (maxMonth > 11 ? 1 : 0);
        const adjustedMaxMonth = maxMonth % 12;

        if (
          currentYear > maxYear ||
          (currentYear === maxYear && currentMonth >= adjustedMaxMonth)
        ) {
          alert("ã“ã‚Œä»¥ä¸Šå…ˆã®æœˆã¯è¡¨ç¤ºã§ãã¾ã›ã‚“");
          return;
        }

        if (currentMonth === 11) {
          currentYear++;
          currentMonth = 0;
        } else {
          currentMonth++;
        }
        renderCalendar(currentYear, currentMonth);
      });

      // ==== åˆæœŸè¡¨ç¤ºï¼ˆæ¥æœˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã—ãŸã„å ´åˆï¼‰====
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentYear, currentMonth);

      selectedDateCell = document.querySelector("#calendar-body td.selected");

      // ä¸€ç•ªæœ€åˆã«restoreã‚’å‘¼ã‚“ã§çŠ¶æ…‹åŒæœŸ
      if (selectedDateCell) {
        restoreDayData(selectedDateCell.dataset.date);
      }

      const timeSelect1 = document.getElementById("timeselect");
      const startInput1 = document.getElementById("startTime");
      const endInput1 = document.getElementById("endTime");

      // æƒ…å ±ç™»éŒ²
      const calendarBody = document.getElementById("calendar-body");
      calendarBody.addEventListener("click", (e) => {
        if (e.target.tagName !== "TD" || !e.target.dataset.date) return;

        // --- æ—§æ—¥ä»˜ã‚’ä¿å­˜ ---
        if (selectedDateCell) saveDayData(selectedDateCell.dataset.date);

        // --- é¸æŠçŠ¶æ…‹ã‚’å¤‰æ›´ ---
        document
          .querySelectorAll("#calendar-body td")
          .forEach((td) => td.classList.remove("selected"));
        e.target.classList.add("selected");
        selectedDateCell = e.target;

        // ---  æ–°ã—ã„æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ ---
        restoreDayData(selectedDateCell.dataset.date);
      });

      // --- æ—¥ä»˜ã®æƒ…å ±ã‚’ä¿å­˜ ---
      function saveDayData(dateKey) {
        const blocks = container.querySelectorAll(".time-block");
        const dayData = [];

        blocks.forEach((block, i) => {
          const mode = block.querySelector(
            `input[name="type${i + 1}"]:checked`
          ).value;
          const select = block.querySelector("select");
          const inputs = block.querySelectorAll('input[type="time"]');
          const leaveType = block.querySelector(
            `input[name="leave-type${i + 1}"]:checked`
          ).value;

          let entry = { mode, leaveType };
          let isValid = false; // æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿åˆ¤å®šãƒ•ãƒ©ã‚°

          if (mode === "split") {
            const val = select.value;
            if (val && val !== "") {
              entry.value = val;
              isValid = true;
            }
          } else {
            const start = inputs[0].value;
            const end = inputs[1].value;
            if (start && end) {
              entry.start = start;
              entry.end = end;
              isValid = true;
            }
          }

          // æœ‰åŠ¹ãªå ´åˆã®ã¿ç™»éŒ²
          if (isValid) {
            dayData.push(entry);
          }
        });

        // ä¿å­˜
        selectedData[dateKey] = dayData;

        // === èƒŒæ™¯è‰²æ›´æ–° ===
        const cell = document.querySelector(`[data-date="${dateKey}"]`);
        if (!cell) return;

        if (dayData.length >= 2) {
          cell.style.background =
            "linear-gradient(to right, pink 50%, lightgreen 50%)";
        } else if (dayData.length === 1) {
          cell.style.background = "pink";
        } else {
          cell.style.background = "";
        }

        console.log(dateKey, dayData);
      }

      // --- æ—¥ä»˜ã®æƒ…å ±ã‚’å¾©å…ƒ ---
      function restoreDayData(dateKey) {
        const data = selectedData[dateKey] || [];

        // ä¸€æ—¦å…¨å‰Šé™¤
        container.innerHTML = "";

        // ãƒ‡ãƒ¼ã‚¿åˆ†ã ã‘ç”Ÿæˆ
        data.forEach((item, i) => {
          const newBlock = document.createElement("div");
          newBlock.className = "time-block";
          newBlock.innerHTML = `
      <button class="remove-btn ${i === 0 ? "hidden" : ""}">å‰Šé™¤</button>
      <div class="block-title">æ™‚é–“å¸¯ ${i + 1}</div>
      <div class="leave-type">
        <label><input type="radio" name="leave-type${i + 1}" value="å…¬ä¼‘" ${
            item.leaveType === "å…¬ä¼‘" ? "checked" : ""
          }>å…¬ä¼‘</label>
        <label><input type="radio" name="leave-type${i + 1}"value="æœ‰çµ¦" ${
            item.leaveType === "æœ‰çµ¦" ? "checked" : ""
          }>æœ‰çµ¦</label>
      </div>
      <hr>
      <div class="radio-group">
        <label><input type="radio" name="type${i + 1}" value="split" ${
            item.mode === "split" ? "checked" : ""
          }> åŒºåˆ†ã‘</label>
        <label><input type="radio" name="type${i + 1}" value="custom" ${
            item.mode === "custom" ? "checked" : ""
          }> ã‚«ã‚¹ã‚¿ãƒ </label>
      </div>
      <div class="select-box ${item.mode === "custom" ? "hidden" : ""}">
        <label>æ™‚é–“åŒºåˆ†ã‘ã‚¿ã‚¤ãƒ—</label>
        <select>
          <option class="default" value="">ã‚¿ã‚¤ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
          <option value="A" ${
            item.value === "A" ? "selected" : ""
          }>A : 07:00~16:00</option>
          <option value="B" ${
            item.value === "B" ? "selected" : ""
          }>B : 08:00~17:00</option>
          <option value="C" ${
            item.value === "C" ? "selected" : ""
          }>C : 09:00~18:00</option>
          <option value="D" ${
            item.value === "D" ? "selected" : ""
          }>D : 10:30~19:30</option>
        </select>
      </div>
      <div class="input-box ${item.mode === "split" ? "hidden" : ""}">
        <input type="time" value="${item.start || ""}">
        <input type="time" value="${item.end || ""}">
      </div>`;
          container.appendChild(newBlock);
          setupRadioEvents(newBlock);
          setupRemoveButton(newBlock);
        });

        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã¨ãã¯æ™‚é–“å¸¯1ã‚’ä½œã‚‹
        if (data.length === 0) {
          addBtn.click();
          container.querySelector(".remove-btn").classList.add("hidden");
        }
      }

      // é€ä¿¡æƒ…å ±ã®æ•´å½¢
      function sendBtn() {
        const name = document
          .querySelector("h2")
          .textContent.replace("æ°åï¼š", "")
          .trim();
        const remarks = document
          .querySelector(".remarks textarea")
          .value.trim();

        const requests = [];

        for (const [dateKey, blocks] of Object.entries(selectedData)) {
          const d = new Date(dateKey);
          // ğŸŒŸ ç¾åœ¨è¡¨ç¤ºä¸­ã®æœˆã®ã¿é€ä¿¡å¯¾è±¡
          if (d.getFullYear() !== currentYear || d.getMonth() !== currentMonth)
            continue;

          blocks.forEach((item) => {
            let startTime, endTime;

            if (item.mode === "split") {
              // åŒºåˆ†ã‘ã‚¿ã‚¤ãƒ—ã®å ´åˆã€é¸æŠå†…å®¹ã‹ã‚‰æ™‚åˆ»ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
              const timeMap = {
                A: ["07:00", "16:00"],
                B: ["08:00", "17:00"],
                C: ["09:00", "18:00"],
                D: ["10:30", "19:30"],
              };
              [startTime, endTime] = timeMap[item.value] || ["", ""];
            } else {
              startTime = item.start || "";
              endTime = item.end || "";
            }

            if (startTime && endTime) {
              requests.push({
                start: `${dateKey.replace(/-/g, "/")} ${startTime}`,
                end: `${dateKey.replace(/-/g, "/")} ${endTime}`,
                leaveType: item.leaveType,
                paidHours: "å…¨æ™‚é–“",
              });
            }
          });
        }

        const sendData = {
          name,
          remarks,
          requests,
        };

        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
        console.log(sendData);

        alert("é€ä¿¡ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã—ãŸï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦‹ã¦ãã ã•ã„ï¼‰");
      }
    </script>
  </body>
</html>
